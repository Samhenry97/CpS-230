JWasm v2.11, Oct 20 2013
graph.asm
                                .model small
                                .386
                                .stack 100h

                                .data

00000000  0000                  last_tick	word	?

                                ; Smooth-blending 256 color palette
                                ; generated by a Python script
                                ; (RGB values in the range 0-63)
00000002  000000                palette	byte	0, 0, 0
00000005  010000                	byte	1, 0, 0
00000008  020000                	byte	2, 0, 0
0000000B  030000                	byte	3, 0, 0
0000000E  040000                	byte	4, 0, 0
00000011  050000                	byte	5, 0, 0
00000014  060000                	byte	6, 0, 0
00000017  070000                	byte	7, 0, 0
0000001A  080000                	byte	8, 0, 0
0000001D  090000                	byte	9, 0, 0
00000020  0A0000                	byte	10, 0, 0
00000023  0B0000                	byte	11, 0, 0
00000026  0C0000                	byte	12, 0, 0
00000029  0D0000                	byte	13, 0, 0
0000002C  0E0000                	byte	14, 0, 0
0000002F  0F0000                	byte	15, 0, 0
00000032  100000                	byte	16, 0, 0
00000035  110000                	byte	17, 0, 0
00000038  120000                	byte	18, 0, 0
0000003B  130000                	byte	19, 0, 0
0000003E  140000                	byte	20, 0, 0
00000041  150000                	byte	21, 0, 0
00000044  160000                	byte	22, 0, 0
00000047  170000                	byte	23, 0, 0
0000004A  180000                	byte	24, 0, 0
0000004D  190000                	byte	25, 0, 0
00000050  1A0000                	byte	26, 0, 0
00000053  1B0000                	byte	27, 0, 0
00000056  1C0000                	byte	28, 0, 0
00000059  1D0000                	byte	29, 0, 0
0000005C  1E0000                	byte	30, 0, 0
0000005F  1F0000                	byte	31, 0, 0
00000062  200000                	byte	32, 0, 0
00000065  210000                	byte	33, 0, 0
00000068  220000                	byte	34, 0, 0
0000006B  230000                	byte	35, 0, 0
0000006E  240000                	byte	36, 0, 0
00000071  250000                	byte	37, 0, 0
00000074  260000                	byte	38, 0, 0
00000077  270000                	byte	39, 0, 0
0000007A  280000                	byte	40, 0, 0
0000007D  290000                	byte	41, 0, 0
00000080  2A0000                	byte	42, 0, 0
00000083  2B0000                	byte	43, 0, 0
00000086  2C0000                	byte	44, 0, 0
00000089  2D0000                	byte	45, 0, 0
0000008C  2E0000                	byte	46, 0, 0
0000008F  2F0000                	byte	47, 0, 0
00000092  300000                	byte	48, 0, 0
00000095  310000                	byte	49, 0, 0
00000098  320000                	byte	50, 0, 0
0000009B  330000                	byte	51, 0, 0
0000009E  340000                	byte	52, 0, 0
000000A1  350000                	byte	53, 0, 0
000000A4  360000                	byte	54, 0, 0
000000A7  370000                	byte	55, 0, 0
000000AA  380000                	byte	56, 0, 0
000000AD  390000                	byte	57, 0, 0
000000B0  3A0000                	byte	58, 0, 0
000000B3  3B0000                	byte	59, 0, 0
000000B6  3C0000                	byte	60, 0, 0
000000B9  3D0000                	byte	61, 0, 0
000000BC  3E0000                	byte	62, 0, 0
000000BF  3F0000                	byte	63, 0, 0
000000C2  3F0000                	byte	63, 0, 0
000000C5  3F0100                	byte	63, 1, 0
000000C8  3F0200                	byte	63, 2, 0
000000CB  3F0300                	byte	63, 3, 0
000000CE  3F0400                	byte	63, 4, 0
000000D1  3F0500                	byte	63, 5, 0
000000D4  3F0600                	byte	63, 6, 0
000000D7  3F0700                	byte	63, 7, 0
000000DA  3F0800                	byte	63, 8, 0
000000DD  3F0900                	byte	63, 9, 0
000000E0  3F0A00                	byte	63, 10, 0
000000E3  3F0B00                	byte	63, 11, 0
000000E6  3F0C00                	byte	63, 12, 0
000000E9  3F0D00                	byte	63, 13, 0
000000EC  3F0E00                	byte	63, 14, 0
000000EF  3F0F00                	byte	63, 15, 0
000000F2  3F1000                	byte	63, 16, 0
000000F5  3F1100                	byte	63, 17, 0
000000F8  3F1200                	byte	63, 18, 0
000000FB  3F1300                	byte	63, 19, 0
000000FE  3F1400                	byte	63, 20, 0
00000101  3F1500                	byte	63, 21, 0
00000104  3F1600                	byte	63, 22, 0
00000107  3F1700                	byte	63, 23, 0
0000010A  3F1800                	byte	63, 24, 0
0000010D  3F1900                	byte	63, 25, 0
00000110  3F1A00                	byte	63, 26, 0
00000113  3F1B00                	byte	63, 27, 0
00000116  3F1C00                	byte	63, 28, 0
00000119  3F1D00                	byte	63, 29, 0
0000011C  3F1E00                	byte	63, 30, 0
0000011F  3F1F00                	byte	63, 31, 0
00000122  3F2000                	byte	63, 32, 0
00000125  3F2100                	byte	63, 33, 0
00000128  3F2200                	byte	63, 34, 0
0000012B  3F2300                	byte	63, 35, 0
0000012E  3F2400                	byte	63, 36, 0
00000131  3F2500                	byte	63, 37, 0
00000134  3F2600                	byte	63, 38, 0
00000137  3F2700                	byte	63, 39, 0
0000013A  3F2800                	byte	63, 40, 0
0000013D  3F2900                	byte	63, 41, 0
00000140  3F2A00                	byte	63, 42, 0
00000143  3F2B00                	byte	63, 43, 0
00000146  3F2C00                	byte	63, 44, 0
00000149  3F2D00                	byte	63, 45, 0
0000014C  3F2E00                	byte	63, 46, 0
0000014F  3F2F00                	byte	63, 47, 0
00000152  3F3000                	byte	63, 48, 0
00000155  3F3100                	byte	63, 49, 0
00000158  3F3200                	byte	63, 50, 0
0000015B  3F3300                	byte	63, 51, 0
0000015E  3F3400                	byte	63, 52, 0
00000161  3F3500                	byte	63, 53, 0
00000164  3F3600                	byte	63, 54, 0
00000167  3F3700                	byte	63, 55, 0
0000016A  3F3800                	byte	63, 56, 0
0000016D  3F3900                	byte	63, 57, 0
00000170  3F3A00                	byte	63, 58, 0
00000173  3F3B00                	byte	63, 59, 0
00000176  3F3C00                	byte	63, 60, 0
00000179  3F3D00                	byte	63, 61, 0
0000017C  3F3E00                	byte	63, 62, 0
0000017F  3F3F00                	byte	63, 63, 0
00000182  3F3F00                	byte	63, 63, 0
00000185  3F3F01                	byte	63, 63, 1
00000188  3F3F02                	byte	63, 63, 2
0000018B  3F3F03                	byte	63, 63, 3
0000018E  3F3F04                	byte	63, 63, 4
00000191  3F3F05                	byte	63, 63, 5
00000194  3F3F06                	byte	63, 63, 6
00000197  3F3F07                	byte	63, 63, 7
0000019A  3F3F08                	byte	63, 63, 8
0000019D  3F3F09                	byte	63, 63, 9
000001A0  3F3F0A                	byte	63, 63, 10
000001A3  3F3F0B                	byte	63, 63, 11
000001A6  3F3F0C                	byte	63, 63, 12
000001A9  3F3F0D                	byte	63, 63, 13
000001AC  3F3F0E                	byte	63, 63, 14
000001AF  3F3F0F                	byte	63, 63, 15
000001B2  3F3F10                	byte	63, 63, 16
000001B5  3F3F11                	byte	63, 63, 17
000001B8  3F3F12                	byte	63, 63, 18
000001BB  3F3F13                	byte	63, 63, 19
000001BE  3F3F14                	byte	63, 63, 20
000001C1  3F3F15                	byte	63, 63, 21
000001C4  3F3F16                	byte	63, 63, 22
000001C7  3F3F17                	byte	63, 63, 23
000001CA  3F3F18                	byte	63, 63, 24
000001CD  3F3F19                	byte	63, 63, 25
000001D0  3F3F1A                	byte	63, 63, 26
000001D3  3F3F1B                	byte	63, 63, 27
000001D6  3F3F1C                	byte	63, 63, 28
000001D9  3F3F1D                	byte	63, 63, 29
000001DC  3F3F1E                	byte	63, 63, 30
000001DF  3F3F1F                	byte	63, 63, 31
000001E2  3F3F20                	byte	63, 63, 32
000001E5  3F3F21                	byte	63, 63, 33
000001E8  3F3F22                	byte	63, 63, 34
000001EB  3F3F23                	byte	63, 63, 35
000001EE  3F3F24                	byte	63, 63, 36
000001F1  3F3F25                	byte	63, 63, 37
000001F4  3F3F26                	byte	63, 63, 38
000001F7  3F3F27                	byte	63, 63, 39
000001FA  3F3F28                	byte	63, 63, 40
000001FD  3F3F29                	byte	63, 63, 41
00000200  3F3F2A                	byte	63, 63, 42
00000203  3F3F2B                	byte	63, 63, 43
00000206  3F3F2C                	byte	63, 63, 44
00000209  3F3F2D                	byte	63, 63, 45
0000020C  3F3F2E                	byte	63, 63, 46
0000020F  3F3F2F                	byte	63, 63, 47
00000212  3F3F30                	byte	63, 63, 48
00000215  3F3F31                	byte	63, 63, 49
00000218  3F3F32                	byte	63, 63, 50
0000021B  3F3F33                	byte	63, 63, 51
0000021E  3F3F34                	byte	63, 63, 52
00000221  3F3F35                	byte	63, 63, 53
00000224  3F3F36                	byte	63, 63, 54
00000227  3F3F37                	byte	63, 63, 55
0000022A  3F3F38                	byte	63, 63, 56
0000022D  3F3F39                	byte	63, 63, 57
00000230  3F3F3A                	byte	63, 63, 58
00000233  3F3F3B                	byte	63, 63, 59
00000236  3F3F3C                	byte	63, 63, 60
00000239  3F3F3D                	byte	63, 63, 61
0000023C  3F3F3E                	byte	63, 63, 62
0000023F  3F3F3F                	byte	63, 63, 63
00000242  3F3F3F                	byte	63, 63, 63
00000245  3F3F3F                	byte	63, 63, 63
00000248  3E3E3E                	byte	62, 62, 62
0000024B  3D3D3D                	byte	61, 61, 61
0000024E  3C3C3C                	byte	60, 60, 60
00000251  3B3B3B                	byte	59, 59, 59
00000254  3A3A3A                	byte	58, 58, 58
00000257  393939                	byte	57, 57, 57
0000025A  383838                	byte	56, 56, 56
0000025D  373737                	byte	55, 55, 55
00000260  363636                	byte	54, 54, 54
00000263  353535                	byte	53, 53, 53
00000266  343434                	byte	52, 52, 52
00000269  333333                	byte	51, 51, 51
0000026C  323232                	byte	50, 50, 50
0000026F  313131                	byte	49, 49, 49
00000272  303030                	byte	48, 48, 48
00000275  2F2F2F                	byte	47, 47, 47
00000278  2E2E2E                	byte	46, 46, 46
0000027B  2D2D2D                	byte	45, 45, 45
0000027E  2C2C2C                	byte	44, 44, 44
00000281  2B2B2B                	byte	43, 43, 43
00000284  2A2A2A                	byte	42, 42, 42
00000287  292929                	byte	41, 41, 41
0000028A  282828                	byte	40, 40, 40
0000028D  272727                	byte	39, 39, 39
00000290  262626                	byte	38, 38, 38
00000293  252525                	byte	37, 37, 37
00000296  242424                	byte	36, 36, 36
00000299  232323                	byte	35, 35, 35
0000029C  222222                	byte	34, 34, 34
0000029F  212121                	byte	33, 33, 33
000002A2  202020                	byte	32, 32, 32
000002A5  1F1F1F                	byte	31, 31, 31
000002A8  1E1E1E                	byte	30, 30, 30
000002AB  1D1D1D                	byte	29, 29, 29
000002AE  1C1C1C                	byte	28, 28, 28
000002B1  1B1B1B                	byte	27, 27, 27
000002B4  1A1A1A                	byte	26, 26, 26
000002B7  191919                	byte	25, 25, 25
000002BA  181818                	byte	24, 24, 24
000002BD  171717                	byte	23, 23, 23
000002C0  161616                	byte	22, 22, 22
000002C3  151515                	byte	21, 21, 21
000002C6  141414                	byte	20, 20, 20
000002C9  131313                	byte	19, 19, 19
000002CC  121212                	byte	18, 18, 18
000002CF  111111                	byte	17, 17, 17
000002D2  101010                	byte	16, 16, 16
000002D5  0F0F0F                	byte	15, 15, 15
000002D8  0E0E0E                	byte	14, 14, 14
000002DB  0D0D0D                	byte	13, 13, 13
000002DE  0C0C0C                	byte	12, 12, 12
000002E1  0B0B0B                	byte	11, 11, 11
000002E4  0A0A0A                	byte	10, 10, 10
000002E7  090909                	byte	9, 9, 9
000002EA  080808                	byte	8, 8, 8
000002ED  070707                	byte	7, 7, 7
000002F0  060606                	byte	6, 6, 6
000002F3  050505                	byte	5, 5, 5
000002F6  040404                	byte	4, 4, 4
000002F9  030303                	byte	3, 3, 3
000002FC  020202                	byte	2, 2, 2
000002FF  010101                	byte	1, 1, 1

00000000                        .code
00000000                        main proc
00000000  B80000                	mov	ax, DGROUP
00000003  8ED8                  	mov	ds, ax
00000005  FC                    	cld				; DF=0; lodsb moves forward
                                	
                                	; Set VGA low-res/high-color graphics mode
                                	; (320x200 pixels, 256 colors, 1 byte per pixel)
00000006  B81300                	mov	ax, 0013h
00000009  CD10                  	int	10h
                                	
                                	; Draw a rainbow on the screen
                                	; (Still using the default palette)
0000000B  B800A0                	mov	ax, 0A000h
0000000E  8EC0                  	mov	es, ax
00000010  B9007D                	mov	cx, 320*100
00000013  BF0000                	mov	di, 0
00000016                        loopy:
00000016  8BC7                  	mov	ax, di
00000018  8AC4                  	mov	al, ah
0000001A  AB                    	stosw
0000001B  E2F9                  	loopw	loopy
                                	
                                	; Turn on the mouse cursor
0000001D  B80100                	mov	ax, 0001h
00000020  CD33                  	int	33h
                                	
                                	; Read a key
00000022  B410                  	mov	ah, 10h
00000024  CD16                  	int	16h
                                	
00000026  BF0000                	mov	di, 0
00000029                        L1:
                                	; Select starting color (DI) for VGA palette transformation
                                	; (Color transforms "wrap" around, so if we start at color
                                	; 200, the first 56 colors in the table will go in palette
                                	; slots 200-255, then the remaining 200 will go in 0-199...)
00000029  BAC803                	mov	dx, 3C8h	; "starting color" port
0000002C  8BC7                  	mov	ax, di
0000002E  32E4                  	xor	ah, ah
00000030  EE                    	out	dx, al
                                	
                                	; Blast the color table out to the VGA registers
00000031  B90001                	mov	cx, 256
00000034  BAC903                	mov	dx, 3C9h	; "R/G/B data" port
00000037  BE0200                	mov	si, offset palette
0000003A                        L2:
0000003A  AC                    	lodsb
0000003B  EE                    	out	dx, al		; Red
0000003C  AC                    	lodsb
0000003D  EE                    	out	dx, al		; Green
0000003E  AC                    	lodsb
0000003F  EE                    	out	dx, al		; Blue
00000040  E2F8                  	loopw	L2
                                	
                                	; Delay loop (use BIOS to detect clock tick)
00000042  B400                  	mov	ah, 0
00000044  CD1A                  	int	1Ah
00000046  89160000              	mov	[last_tick], dx		; Stash last tick count (least-significant WORD)
0000004A                        sleepy:
0000004A  B400                  	mov	ah, 0
0000004C  CD1A                  	int	1Ah
0000004E  8B0E0000              	mov	cx, [last_tick]
00000052  3BD1                  	cmp	dx, cx			; Compare to current tick count...
00000054  74F4                  	je	sleepy			; ...if still equal, try again
                                	
                                	; Check for keystroke (without blocking/hanging)
00000056  B401                  	mov	ah, 01h
00000058  CD16                  	int	16h
0000005A  7503                  	jnz	breakout
                                	
                                	; Next cycle
0000005C  47                    	inc	di			; Cycle colors continuously
0000005D  EBCA                  	jmp	L1
0000005F                        breakout:
                                	
                                	; Turn off the mouse cursor
0000005F  B80200                	mov	ax, 0002h
00000062  CD33                  	int	33h
                                	
                                	; Resume 80-column text mode
00000064  B80300                	mov	ax, 0003h
00000067  CD10                  	int	10h
                                	
                                	; Quit to DOS
00000069  B44C                  	mov	ah, 4Ch
0000006B  CD21                  	int	21h
0000006D                        main endp

                                end main


Macros:

                N a m e                 Type

@CatStr  . . . . . . . . . . . .        Func
@Environ . . . . . . . . . . . .        Func
@InStr . . . . . . . . . . . . .        Func
@SizeStr . . . . . . . . . . . .        Func
@SubStr  . . . . . . . . . . . .        Func


Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

$$SYMBOLS  . . . . . . . . . . .        32 Bit   000000BF Byte    Private 'DEBSYM'
$$TYPES  . . . . . . . . . . . .        32 Bit   00000026 Byte    Private 'DEBTYP'
_TEXT  . . . . . . . . . . . . .        16 Bit   006D     Word    Public  'CODE'
DGROUP . . . . . . . . . . . . .        GROUP
_DATA  . . . . . . . . . . . . .        16 Bit   0302     Word    Public  'DATA'
STACK  . . . . . . . . . . . . .        16 Bit   0100     Para    Stack   'STACK'


Procedures, parameters and locals:

                N a m e                 Type     Value    Segment  Length

main . . . . . . . . . . . . . .        P Near   0000     _TEXT    006D Private  


Symbols:

                N a m e                 Type       Value     Attr

@CodeSize  . . . . . . . . . . .        Number             0h 
@DataSize  . . . . . . . . . . .        Number             0h 
@Interface . . . . . . . . . . .        Number             0h 
@Model . . . . . . . . . . . . .        Number             2h 
@code  . . . . . . . . . . . . .        Text   _TEXT
@data  . . . . . . . . . . . . .        Text   DGROUP
@stack . . . . . . . . . . . . .        Text   DGROUP
L1 . . . . . . . . . . . . . . .        L Near            29h _TEXT 
L2 . . . . . . . . . . . . . . .        L Near            3Ah _TEXT 
breakout . . . . . . . . . . . .        L Near            5Fh _TEXT 
last_tick  . . . . . . . . . . .        Word               0h _DATA 
loopy  . . . . . . . . . . . . .        L Near            16h _TEXT 
palette  . . . . . . . . . . . .        Byte[3]            2h _DATA 
sleepy . . . . . . . . . . . . .        L Near            4Ah _TEXT 

graph.asm: 358 lines, 2 passes, 47 ms, 0 warnings, 0 errors
